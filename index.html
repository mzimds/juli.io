<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>DONTMED - Gestão Avançada de Plantões</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c7da0;
            --primary-dark: #1a5276;
            --secondary: #468faf;
            --light: #ffffff;
            --dark: #333333;
            --darker: #222222;
            --danger: #e74c3c;
            --danger-dark: #c0392b;
            --success: #2ecc71;
            --success-dark: #27ae60;
            --warning: #f39c12;
            --warning-dark: #e67e22;
            --pass-plantao: #2ecc71;
            --gray: #95a5a6;
            --light-gray: #f5f5f5;
            --border: rgba(0, 0, 0, 0.1);
            --sidebar-width: 280px;
            --header-height: 60px;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.05);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.15);
            --pending: #222;
            --lavender: #9A85F9;
            --skyblue: #58B7F4;
            --turno-ativo: #2ecc71;
            --turno-proximo: #3498db;
            --turno-encerrado: #95a5a6;
            --turno-pendente: #e74c3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: var(--light);
            color: var(--dark);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: -webkit-fill-available;
        }

        .card {
            background: var(--light);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
            border-radius: 8px;
        }

        header {
            height: var(--header-height);
            background: var(--light);
            color: var(--darker);
            padding: 0 15px;
            display: flex;
            align-items: center;
            position: relative;
            z-index: 100;
            box-shadow: var(--shadow-sm);
            border-bottom: 1px solid var(--border);
        }

        .logo {
            font-weight: 700;
            font-size: 1.5rem;
            letter-spacing: -0.5px;
            font-family: 'Inter', sans-serif;
            font-weight: 800;
            margin-right: auto;
            color: var(--darker);
        }

        .header-info {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 0.9rem;
            color: var(--dark);
        }

        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
            padding: 12px;
            gap: 12px;
            background: var(--light-gray);
            height: calc(100dvh - var(--header-height));
            min-height: 0;
        }

        .sidebar {
            width: var(--sidebar-width);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .section-header {
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            font-weight: 600;
            color: var(--darker);
            font-size: 1.1rem;
        }

        .btn {
            padding: 8px 12px;
            background: var(--light);
            color: var(--darker);
            border: 1px solid var(--darker);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            font-weight: 500;
            box-shadow: var(--shadow-sm);
        }

        .btn:hover {
            background: rgba(0, 0, 0, 0.05);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        .btn-success {
            background: var(--success);
            color: white;
            border-color: var(--success-dark);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
            border-color: var(--warning-dark);
        }

        .btn-pass {
            background: var(--pass-plantao);
            color: white;
        }

        .search-container {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            position: relative;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            resize: none;
            font-size: 0.95rem;
            font-family: 'Inter', sans-serif;
            background: var(--light);
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
            box-shadow: var(--shadow-sm);
        }

        .search-box input:focus {
            background: white;
            box-shadow: 0 0 0 2px rgba(44, 125, 160, 0.2);
            outline: none;
            border-color: var(--primary);
            border-image: linear-gradient(90deg, var(--lavender), var(--skyblue));
            border-image-slice: 1;
        }

        .autocomplete-container {
            position: absolute;
            top: calc(100% + 5px);
            left: 0;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: var(--shadow-md);
            z-index: 200;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        
        .autocomplete-container.visible {
            display: block;
        }
        
        .autocomplete-header {
            display: none;
        }
        
        .autocomplete-item {
            padding: 10px 15px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
        }
        
        .autocomplete-item:hover {
            background-color: rgba(44, 125, 160, 0.05);
        }
        
        .highlight {
            background-color: rgba(255, 217, 0, 0.3);
            font-weight: 600;
            padding: 0 2px;
            border-radius: 3px;
        }

        .scrollable-content {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }

        .setor-item {
            padding: 12px 15px;
            cursor: pointer;
            transition: background-color 0.2s;
            border-left: 3px solid transparent;
            margin: 4px 8px;
            border-radius: 6px;
            background: var(--light);
            box-shadow: var(--shadow-sm);
        }

        .setor-item:hover {
            background-color: rgba(44, 125, 160, 0.05);
        }

        .setor-item.active {
            background-color: rgba(0, 0, 0, 0.03);
        }

        .setor-name {
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--darker);
        }

        .turno-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .turno-ativo {
            background: linear-gradient(90deg, var(--turno-ativo), var(--success-dark));
            color: white;
        }

        .turno-proximo {
            background: linear-gradient(90deg, var(--turno-proximo), #2980b9);
            color: white;
        }

        .turno-encerrado {
            background: var(--light-gray);
            color: var(--gray);
        }

        .turno-pendente {
            background: linear-gradient(90deg, var(--turno-pendente), var(--danger-dark));
            color: white;
        }

        .turno-icon {
            margin-left: 5px;
        }

        .pacientes-container {
            margin-top: 8px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            padding: 0;
        }

        .setor-item.expanded .pacientes-container {
            max-height: 1000px;
        }

        .paciente-item {
            padding: 10px;
            border-bottom: 1px dashed var(--border);
            border-radius: 6px;
            margin: 5px 0;
            transition: all 0.2s ease;
            background: var(--light);
        }

        .paciente-item:hover {
            background-color: rgba(44, 125, 160, 0.05);
        }

        .paciente-item:last-child {
            border-bottom: none;
        }

        .paciente-info {
            min-width: 0;
        }

        .paciente-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .paciente-name {
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.95rem;
            margin-bottom: 4px;
            color: var(--darker);
            flex: 1;
        }

        .paciente-status {
            display: flex;
            gap: 4px;
        }

        .paciente-details {
            font-size: 0.82rem;
            color: var(--gray);
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .badge {
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 10px;
            background: linear-gradient(90deg, var(--lavender), var(--skyblue));
            color: white !important;
            font-weight: 500;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            min-height: 0;
        }

        .patient-header {
            padding: 12px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: 8px;
            background: var(--light);
        }

        .patient-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--darker);
            letter-spacing: -0.3px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .soap-tabs {
            display: flex;
            background-color: white;
            border-bottom: 1px solid var(--border);
            background: var(--light);
            overflow-x: auto;
        }

        .soap-tab {
            padding: 10px 15px;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            border-bottom: 3px solid transparent;
            transition: all 0.2s ease;
            font-size: 0.92rem;
            white-space: nowrap;
        }

        .soap-tab:hover {
            color: var(--darker);
            background: rgba(44, 125, 160, 0.05);
        }

        .soap-tab.active {
            color: var(--darker);
            border-bottom: 3px solid var(--darker);
            background: rgba(44, 125, 160, 0.08);
        }

        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--light);
            min-height: 0;
            height: 100%;
        }

        .editor-content {
            flex: 1;
            display: none;
            flex-direction: column;
            padding: 12px;
            overflow: hidden;
            min-height: 0;
        }

        .editor-content.active {
            display: flex;
        }

        .editor-header {
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .editor-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--darker);
            text-align: left;
        }

        .quick-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .quick-action {
            padding: 6px 10px;
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            box-shadow: var(--shadow-sm);
        }

        .quick-action:hover {
            background: rgba(44, 125, 160, 0.1);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .textarea-container {
            position: relative;
            flex: 1;
            min-height: 100px;
            overflow: hidden;
        }

        .soap-textarea {
            width: 100%;
            height: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            resize: none;
            font-size: 1rem;
            line-height: 1.5;
            font-family: 'Inter', sans-serif;
            background: var(--light);
            transition: all 0.2s ease;
            box-shadow: var(--shadow-sm);
        }

        .soap-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(44, 125, 160, 0.2);
            border-image: linear-gradient(90deg, var(--lavender), var(--skyblue));
            border-image-slice: 1;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            margin-right: 12px;
            width: 30px;
            height: 30px;
            position: relative;
            z-index: 110;
        }

        .mobile-menu-btn span,
        .mobile-menu-btn span::before,
        .mobile-menu-btn span::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 3px;
            background: var(--darker);
            border-radius: 2px;
            transition: all 0.3s ease;
            left: 0;
        }

        .mobile-menu-btn span {
            top: 50%;
            transform: translateY(-50%);
        }

        .mobile-menu-btn span::before {
            top: -8px;
        }

        .mobile-menu-btn span::after {
            top: 8px;
        }

        .mobile-menu-btn.open span {
            background: transparent;
        }

        .mobile-menu-btn.open span::before {
            top: 0;
            transform: rotate(45deg);
        }

        .mobile-menu-btn.open span::after {
            top: 0;
            transform: rotate(-45deg);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 20px;
            border-radius: 10px;
            transform: translateY(20px);
            transition: transform 0.3s ease;
            background: var(--light);
            box-shadow: var(--shadow-md);
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
            text-align: left;
        }

        .modal-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--darker);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            resize: none;
            font-size: 0.95rem;
            font-family: 'Inter', sans-serif;
            background: var(--light);
            transition: all 0.2s ease;
            box-shadow: var(--shadow-sm);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(44, 125, 160, 0.2);
            border-image: linear-gradient(90deg, var(--lavender), var(--skyblue));
            border-image-slice: 1;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 6px;
            background: linear-gradient(90deg, var(--lavender), var(--skyblue));
            color: white;
            font-weight: 500;
            box-shadow: var(--shadow-md);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            z-index: 2000;
            max-width: 320px;
            display: flex;
            align-items: center;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast-success {
            background: linear-gradient(90deg, var(--lavender), var(--skyblue));
        }

        .toast-success::before {
            content: "✓";
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .toast-error {
            background: var(--danger);
        }

        .toast-error::before {
            content: "⚠";
            margin-right: 10px;
            font-size: 1.2rem;
        }

        @keyframes toastIn {
            0% { transform: translateX(100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        .toast.show {
            animation: toastIn 0.5s forwards;
        }

        .save-indicator {
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-size: 0.75rem;
            color: var(--success);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .save-indicator.show {
            opacity: 1;
        }

        .loader {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .setor-name span:last-child {
            background: none;
            padding: 0;
            border-radius: 0;
            font-weight: 600;
            color: var(--darker);
        }

        .disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            background: white;
            border: 1px solid var(--dark);
            color: var(--dark);
        }

        .status-badge.alta {
            border-color: var(--success);
            color: var(--success);
        }

        .status-badge.pendencia {
            border-color: var(--pending);
            color: var(--pending);
        }

        .chat-area {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 0;
            overflow: hidden;
            position: relative;
        }

        .chat-history-container {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
            padding-bottom: 10px;
            -webkit-overflow-scrolling: touch;
        }

        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-height: 0;
        }

        .message {
            max-width: 100%;
            padding: 8px 0;
            position: relative;
            background: none !important;
            box-shadow: none !important;
            border-radius: 0;
            color: var(--dark);
        }

        .message-doctor {
            align-self: flex-end;
            text-align: right;
        }

        .message-system {
            align-self: center;
            text-align: center;
            font-style: italic;
            color: var(--gray);
        }

        .message-timestamp {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 2px;
            color: var(--gray);
        }

        .message-signature {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 4px;
        }

        .message-input-container {
            position: relative;
            display: flex;
            padding: 0;
            border-radius: 6px;
            background: var(--light);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
            transition: all 0.2s ease;
            z-index: 30;
        }

        .message-input-container:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(44, 125, 160, 0.2);
            border-image: linear-gradient(90deg, var(--lavender), var(--skyblue));
            border-image-slice: 1;
        }

        .keyboard-open .message-input-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 10px;
            background: white;
            border-radius: 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 2000; /* Aumentado para 2000 */
        }

        .keyboard-open .chat-history-container {
            padding-bottom: 70px;
        }

        .message-input {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            resize: none;
            font-size: 0.95rem;
            font-family: 'Inter', sans-serif;
            min-height: 60px;
            max-height: 150px;
            background: transparent;
            outline: none;
            box-shadow: none;
        }

        .message-input:focus {
            outline: none;
        }

        .btn-send {
            background: var(--gray);
            color: white;
            border: none;
            border-radius: 0 6px 6px 0;
            cursor: pointer;
            width: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
            z-index: 35;
        }

        .btn-send:disabled {
            cursor: not-allowed;
        }

        .btn-send:not(:disabled) {
            background: linear-gradient(90deg, var(--lavender), var(--skyblue));
        }

        .btn-send:hover:not(:disabled) {
            opacity: 0.9;
        }

        .progress-container {
            margin-bottom: 15px;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            height: 4px;
            background: var(--light-gray);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--lavender), var(--skyblue));
            border-radius: 2px;
        }

        .patient-title-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            gap: 5px;
        }

        .patient-details {
            display: none;
            flex-direction: column;
            gap: 5px;
            font-size: 0.9rem;
            color: var(--dark);
            padding-top: 8px;
            border-top: 1px solid var(--border);
            margin-top: 8px;
        }

        .patient-title-wrapper {
            display: flex;
            align-items: center;
            gap: 5px;
            flex: 1;
            min-width: 0;
        }
        
        .empty-state {
            display: flex;
            flex: 1;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
        }

        .empty-content {
            max-width: 500px;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.7;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--darker);
        }

        .empty-state p {
            color: var(--gray);
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .empty-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .empty-actions .btn {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .empty-actions .btn span {
            font-size: 1.2rem;
        }

        .pass-plantao-sidebar {
            padding: 15px;
            border-top: 1px solid var(--border);
            display: none;
        }
        
        .pass-plantao-sidebar .btn {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .turno-section {
            margin-bottom: 15px;
            padding: 15px;
            background: var(--light-gray);
            border-radius: 8px;
            position: relative;
            border: 1px solid var(--border);
        }

        .turno-section h4 {
            margin-bottom: 10px;
            font-size: 1rem;
            color: var(--darker);
        }

        .turno-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .btn-remove-turno {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--darker);
            cursor: pointer;
            font-size: 1.2rem;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .btn-remove-turno:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .error-message {
            color: var(--danger);
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
        }

        .has-error {
            border-color: var(--danger) !important;
        }

        .btn-add-turno {
            padding: 5px 10px;
            background: linear-gradient(90deg, var(--lavender), var(--skyblue));
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 10px;
            margin-left: auto;
            font-size: 0.85rem;
        }

        .btn-add-turno:hover {
            opacity: 0.9;
        }
        
        .pendencias-container {
            padding: 0 15px 10px;
            background: var(--light);
            border-bottom: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .pendencia-card.expanded .pendencia-content {
            padding: 0;
        }
        
        .pendencia-card.expanded .pendencia-desc,
        .pendencia-card.expanded .pendencia-footer {
            display: block;
        }
        
        .pendencia-card.expanded .pendencia-header {
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }

        .context-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 6px;
            box-shadow: var(--shadow-md);
            z-index: 1000;
            display: none;
            width: 180px;
            overflow: hidden;
        }

        .context-menu.visible {
            display: block;
        }

        .context-item {
            padding: 10px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--dark);
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
        }

        .context-item:hover {
            background-color: rgba(44, 125, 160, 0.1);
        }
        
        .btn-context {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--darker);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        
        .btn-context:hover {
            background-color: rgba(0,0,0,0.05);
        }
        
        .btn-context svg {
            width: 24px;
            height: 24px;
        }
        
        .paciente-leito-atendimento {
            font-weight: 600;
        }

        .pendencia-badge {
            background: linear-gradient(90deg, var(--lavender), var(--skyblue)) !important;
            color: white !important;
            margin-left: 8px;
            padding: 2px 8px !important;
            border-radius: 12px !important;
            font-size: 0.75rem !important;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .pendencia-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85rem;
            color: var(--pending);
            font-weight: 600;
        }

        .pendencia-card {
            display: flex;
            flex-direction: column;
            background: rgba(0, 0, 0, 0.03);
            border-radius: 8px;
            margin-top: 8px;
            overflow: hidden;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
            max-height: 45px;
            transition: max-height 0.3s ease;
        }

        .pendencia-card.expanded {
            max-height: 300px;
        }

        .pendencia-content {
            padding: 0;
        }

        .pendencia-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            padding: 8px 15px;
            cursor: pointer;
        }

        .pendencia-header-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pendencia-header-info svg {
            margin-top: 0;
        }

        .pendencia-title {
            font-weight: 600;
            font-size: 0.95rem;
            line-height: 1.2;
        }

        .pendencia-meta {
            font-size: 0.8rem;
            color: var(--gray);
            line-height: 1.2;
        }

        .pendencia-desc {
            font-size: 0.9rem;
            color: var(--dark);
            line-height: 1.4;
            padding: 0 15px 15px 15px;
            display: none;
        }

        .pendencia-footer {
            display: flex;
            justify-content: flex-end;
            padding: 0 15px 15px 15px;
            display: none;
        }

        .btn-resolver {
            padding: 6px 12px;
            background: linear-gradient(90deg, var(--lavender), var(--skyblue));
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .btn-resolver:hover {
            opacity: 0.9;
        }
        
        .patient-actions {
            position: relative;
            display: none;
        }

        .context-menu {
            top: calc(100% + 5px);
            right: 0;
            margin-top: 5px;
        }

        .context-menu.visible {
            display: block;
            z-index: 1001;
        }

        /* Alerta visual em destaque */
        .delete-warning {
            background-color: #fdecea; /* Vermelho claro */
            color: #d93025; /* Vermelho escuro */
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid rgba(217, 48, 37, 0.2);
        }

        /* Modal de Confirmação de Exclusão (MODERNIZADO) */
        .delete-modal-content {
            border-radius: 12px;
            background: var(--light);
            box-shadow: var(--shadow-lg);
            max-width: 500px;
            width: 90%;
            border: 1px solid var(--border);
        }

        .delete-modal-header {
            padding: 20px 20px 10px;
            border-bottom: 1px solid var(--border);
            text-align: left;
        }

        .delete-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--darker);
            margin-bottom: 5px;
        }

        .delete-modal-body {
            padding: 20px;
            color: var(--dark);
            line-height: 1.6;
            text-align: left;
        }
        
        .delete-warning {
            background-color: #fdecea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            text-align: left;
            border: 1px solid rgba(231, 76, 60, 0.2);
            color: #d93025;
        }

        .delete-warning p {
            margin-bottom: 10px;
            color: #d93025;
            font-weight: 500;
        }

        .delete-warning p:last-child {
            margin-bottom: 0;
        }

        .delete-modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 20px;
            background: transparent;
            border-top: 1px solid var(--border);
        }

        .btn-danger {
            background: var(--darker);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-sm);
        }

        .btn-danger:hover {
            background: #111;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: rgba(0,0,0,0.08);
            color: var(--dark);
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary:hover {
            background: rgba(0,0,0,0.15);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        /* Botão desabilitado para exclusão */
        .btn-delete-disabled {
            background: #cccccc !important;
            color: #666666 !important;
            cursor: not-allowed !important;
            opacity: 0.7;
            pointer-events: none;
        }

        /* Histórico de Plantões */
        .historico-container {
            display: flex;
            flex-direction: column;
            padding: 15px;
            gap: 15px;
        }

        .filtros-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 15px;
        }

        .filtro-group {
            display: flex;
            flex-direction: column;
        }

        .filtro-group label {
            font-size: 0.85rem;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--darker);
        }

        .filtro-group select, 
        .filtro-group input {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .historico-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .plantao-card {
            background: white;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .plantao-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .plantao-header {
            padding: 15px;
            background: linear-gradient(90deg, var(--lavender), var(--skyblue));
            color: white;
        }

        .plantao-body {
            padding: 15px;
        }

        .plantao-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .plantao-info-item {
            font-size: 0.9rem;
        }

        .plantao-info-label {
            font-weight: 600;
            color: var(--darker);
        }

        .plantao-info-value {
            color: var(--dark);
        }

        .plantao-acoes {
            display: flex;
            justify-content: space-between;
            padding: 0 15px 15px;
        }

        .plantao-pacientes {
            margin-top: 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .plantao-card.expanded .plantao-pacientes {
            max-height: 500px;
        }

        .plantao-paciente {
            padding: 10px;
            border-bottom: 1px solid var(--border);
        }

        .plantao-paciente:last-child {
            border-bottom: none;
        }

        .btn-toggle {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-weight: 600;
            padding: 5px;
        }

        .export-options {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn-export {
            padding: 8px 15px;
            background: var(--light-gray);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s ease;
        }

        .btn-export:hover {
            background: rgba(0,0,0,0.05);
        }

        .alert-banner {
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }

        .alert-30min {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.3);
            color: #d35400;
        }

        .alert-fim {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid rgba(231, 76, 60, 0.3);
            color: var(--danger-dark);
        }

        .alert-pos {
            background: rgba(149, 165, 166, 0.2);
            border: 1px solid rgba(149, 165, 166, 0.3);
            color: var(--darker);
        }

        .plantao-status {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-em-andamento {
            background: rgba(46, 204, 113, 0.2);
            color: var(--success-dark);
        }

        .status-finalizado {
            background: rgba(149, 165, 166, 0.2);
            color: var(--darker);
        }

        .status-pendente {
            background: rgba(231, 76, 60, 0.2);
            color: var(--danger-dark);
        }

        .timeline {
            position: relative;
            padding-left: 20px;
            margin-top: 15px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 6px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 15px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
        }

        .timeline-content {
            background: white;
            border-radius: 6px;
            padding: 10px;
            box-shadow: var(--shadow-sm);
        }

        .timeline-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .timeline-time {
            font-size: 0.8rem;
            color: var(--gray);
        }

        @media (max-width: 992px) {
            .sidebar {
                position: absolute;
                left: 0;
                top: var(--header-height);
                bottom: 0;
                z-index: 90;
                transform: translateX(-100%);
                width: 100%;
                max-width: 320px;
                box-shadow: var(--shadow-md);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .mobile-menu-btn {
                display: block;
            }

            .container {
                padding: 8px;
                height: calc(100dvh - var(--header-height) - 16px);
            }
            
            .main-content {
                max-height: calc(100dvh - var(--header-height) - 16px);
            }

            .quick-actions {
                overflow-x: auto;
                padding-bottom: 8px;
                flex-wrap: nowrap;
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            
            .quick-actions::-webkit-scrollbar {
                display: none;
            }
            
            .quick-action {
                flex-shrink: 0;
            }

            .editor-container {
                min-height: 0;
                height: 100%;
            }

            #btnPassPlantaoHeader {
                display: none !important;
            }

            .pass-plantao-sidebar {
                display: block;
            }

            .patient-title-container {
                flex-direction: row;
                flex-wrap: wrap;
                align-items: center;
                justify-content: space-between;
            }
            
            .patient-title-wrapper {
                flex: 1;
                min-width: 0;
            }
            
            .patient-title {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .chat-history {
                padding: 8px;
            }
            
            .message {
                padding: 8px 12px;
                max-width: 85%;
            }
            
            .message-input {
                font-size: 1rem;
            }

            .turno-badge {
                padding: 3px 6px;
                font-size: 0.7rem;
            }
        }

        @media (min-width: 993px) {
            .pass-plantao-sidebar {
                display: none;
            }
            
            .btn-pass-header {
                display: block !important;
            }

            .header-info {
                flex-wrap: nowrap;
            }
        }

        @media (max-width: 576px) {
            :root {
                --sidebar-width: 260px;
                --header-height: 55px;
            }

            .container {
                padding: 8px;
                gap: 8px;
            }
            
            .logo {
                font-size: 1.3rem;
            }
            
            .header-info {
                font-size: 0.8rem;
            }
            
            .section-header {
                padding: 10px;
            }
            
            .soap-tabs {
                overflow-x: auto;
                white-space: nowrap;
            }
            
            .soap-tab {
                padding: 8px 12px;
                font-size: 0.85rem;
            }
            
            .editor-content {
                padding: 10px;
            }
            
            .editor-header {
                gap: 8px;
            }
            
            .quick-actions {
                gap: 6px;
            }
            
            .quick-action {
                padding: 5px 8px;
                font-size: 0.8rem;
            }
            
            .patient-header {
                padding: 10px 15px;
            }
            
            .modal-content {
                width: 95%;
                padding: 15px;
            }
            
            .modal-title {
                font-size: 1.3rem;
            }
            
            .form-group {
                margin-bottom: 12px;
            }
            
            .soap-textarea {
                padding: 10px;
                font-size: 0.95rem;
            }

            .pass-plantao-sidebar .btn {
                padding: 15px 10px;
                font-size: 1rem;
            }

            .filtros-container {
                grid-template-columns: 1fr;
            }

            .historico-grid {
                grid-template-columns: 1fr;
            }

            .turno-badge {
                padding: 2px 4px;
                font-size: 0.65rem;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div class="toast" id="toast">
        <span id="toast-message">Operação realizada com sucesso!</span>
    </div>

    <!-- Header -->
    <header>
        <button class="mobile-menu-btn" id="mobileMenuBtn">
            <span></span>
        </button>
        <div class="logo">
            DONTMED
        </div>
        <div class="header-info">
            <!-- Botão passar plantão no header (desktop) -->
            <button class="btn btn-pass btn-pass-header" id="btnPassPlantaoHeader">
                Passar Plantão
            </button>
            <div class="user-info">
                <span>Dr. Carlos Silva</span>
            </div>
            <div class="time-info">
                <span id="currentTime">00:00</span>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar card" id="sidebar">
            <div class="section-header">
                <div class="section-title">Setores</div>
                <button class="btn" id="btnNewSetor">
                    Novo
                </button>
            </div>
            
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Buscar paciente ou setor...">
                    <div class="autocomplete-container" id="autocompleteContainer">
                        <!-- Resultados do autocomplete serão exibidos aqui -->
                    </div>
                </div>
            </div>
            
            <div class="scrollable-content" id="setoresList">
                <!-- Setores serão carregados aqui dinamicamente -->
            </div>
            
            <!-- Botão "Passar Plantão" dentro da sidebar (mobile) -->
            <div class="pass-plantao-sidebar" id="passPlantaoSidebar">
                <button class="btn btn-pass" id="btnPassPlantaoSidebar">
                    Passar Plantão
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content card">
            <!-- Abas -->
            <div class="soap-tabs">
                <div class="soap-tab active" data-tab="plantao">Plantão Ativo</div>
                <div class="soap-tab" data-tab="historico">Histórico</div>
            </div>

            <!-- Conteúdo da aba Plantão Ativo -->
            <div class="editor-content active" id="plantao">
                <div class="patient-header" id="patientHeader">
                    <div class="patient-title-container" id="patientToggle">
                        <div class="patient-title-wrapper">
                            <div class="patient-title" id="patientTitle">
                                <span>Selecione um paciente</span>
                            </div>
                        </div>
                        <!-- Container de ações do paciente -->
                        <div class="patient-actions" id="patientActions" style="display: none;">
                            <button class="btn-context" id="btnContextMenu">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="12" cy="6" r="1.5" fill="currentColor"/>
                                    <circle cx="12" cy="12" r="1.5" fill="currentColor"/>
                                    <circle cx="12" cy="18" r="1.5" fill="currentColor"/>
                                </svg>
                            </button>
                            <div class="context-menu" id="contextMenu">
                                <div class="context-item" data-action="alta">Registrar Alta</div>
                                <div class="context-item" data-action="pendencia">Criar Pendência</div>
                                <div class="context-item" data-action="excluir" style="color: var(--danger);">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 8px;">
                                        <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M10 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M14 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Excluir
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="patient-details" id="patientDetails" style="display: none;">
                        <!-- Detalhes do paciente serão carregados aqui -->
                    </div>
                </div>
                
                <!-- Área de pendências individuais -->
                <div class="pendencias-container" id="pendenciasContainer" style="display: none;">
                    <!-- Pendências serão carregadas aqui dinamicamente -->
                </div>
                
                <div class="editor-container" id="editorContainer">
                    <!-- Chat de mensagens -->
                    <div class="editor-content active" id="chat">
                        <div class="editor-header">
                            <div class="editor-title">Anotações Clínicas</div>
                            <div class="quick-actions">
                                <div class="quick-action" data-text="PA: 120/80 mmHg | FC: 78 bpm | FR: 16 rpm | Temp: 36.5°C">Sinais Vitais</div>
                                <div class="quick-action" data-text="Exame físico: abdômen flácido, indolor à palpação">Exame Físico</div>
                                <div class="quick-action" data-text="Exames laboratoriais dentro dos parâmetros normais">Exames</div>
                                <div class="quick-action" data-text="Paciente relata melhora do quadro">Melhora</div>
                                <div class="quick-action" data-text="Paciente refere dor intensa">Dor</div>
                                <div class="quick-action" data-text="Paciente consciente, orientado, em bom estado geral">Estado Geral</div>
                                <div class="quick-action" data-text="Queixa principal: dor abdominal difusa há 2 dias">Queixas</div>
                                <div class="quick-action" data-text="Conduta: manter hidratação venosa, analgesia e reavaliação em 6h">Conduta</div>
                                <div class="quick-action" data-text="Prescrição: dipirona 1g IV 6/6h, omeprazol 40mg VO 1x/dia">Prescrição</div>
                                <div class="quick-action" data-text="Paciente evolui estável, sem intercorrências">Evolução Estável</div>
                                <div class="quick-action" data-text="Encaminhado para realização de exames laboratoriais e imagem">Encaminhamento</div>
                                <div class="quick-action" data-text="Informado à equipe de enfermagem para monitorização contínua dos sinais vitais">Enfermagem</div>
                            </div>
                        </div>
                        <div class="chat-area">
                            <div class="chat-history-container">
                                <div class="chat-history" id="chatHistory">
                                    <!-- Mensagens serão carregadas aqui -->
                                </div>
                            </div>
                            <div class="message-input-container">
                                <textarea class="message-input" id="messageInput" placeholder="Escreva uma nova anotação clínica..." rows="1"></textarea>
                                <button class="btn-send" id="btnSendMessage" disabled>
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M22 2L11 13" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Conteúdo da aba Histórico -->
            <div class="editor-content" id="historico">
                <div class="historico-container">
                    <div class="filtros-container">
                        <div class="filtro-group">
                            <label>Período</label>
                            <input type="date" id="filtroDataInicio">
                        </div>
                        <div class="filtro-group">
                            <label>até</label>
                            <input type="date" id="filtroDataFim">
                        </div>
                        <div class="filtro-group">
                            <label>Setor</label>
                            <select id="filtroSetor">
                                <option value="">Todos os setores</option>
                                <!-- Opções serão preenchidas dinamicamente -->
                            </select>
                        </div>
                        <div class="filtro-group">
                            <label>Responsável</label>
                            <select id="filtroResponsavel">
                                <option value="">Todos os responsáveis</option>
                                <option value="Dr. Carlos Silva">Dr. Carlos Silva</option>
                                <option value="Dra. Ana Santos">Dra. Ana Santos</option>
                                <option value="Dr. Pedro Oliveira">Dr. Pedro Oliveira</option>
                            </select>
                        </div>
                        <div class="filtro-group">
                            <label>Status</label>
                            <select id="filtroStatus">
                                <option value="">Todos os status</option>
                                <option value="em_andamento">Em andamento</option>
                                <option value="finalizado">Finalizado</option>
                                <option value="pendente">Pendente</option>
                            </select>
                        </div>
                        <div class="filtro-group">
                            <label>&nbsp;</label>
                            <button class="btn" id="btnAplicarFiltros">Aplicar Filtros</button>
                        </div>
                    </div>

                    <div class="export-options">
                        <button class="btn-export" data-format="pdf">
                            <i class="fas fa-file-pdf"></i> PDF
                        </button>
                        <button class="btn-export" data-format="excel">
                            <i class="fas fa-file-excel"></i> Excel
                        </button>
                        <button class="btn-export" data-format="csv">
                            <i class="fas fa-file-csv"></i> CSV
                        </button>
                        <button class="btn-export" data-format="json">
                            <i class="fas fa-file-code"></i> JSON
                        </button>
                    </div>

                    <div class="historico-grid" id="historicoGrid">
                        <!-- Plantões históricos serão carregados aqui -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Passar Plantão -->
    <div class="modal" id="passPlantaoModal">
        <div class="modal-content card">
            <div class="modal-header">
                <h2 class="modal-title">Passagem de Plantão</h2>
            </div>
            
            <div>
                <div class="form-group">
                    <label>Médico Atual</label>
                    <input type="text" class="form-control" value="Dr. Carlos Silva" readonly>
                </div>
                
                <div class="form-group">
                    <label>Médico que Receberá</label>
                    <select class="form-control" id="medicoRecebe">
                        <option value="">Selecione o médico</option>
                        <option value="Dra. Ana Santos">Dra. Ana Santos</option>
                        <option value="Dr. Pedro Oliveira">Dr. Pedro Oliveira</option>
                        <option value="Dra. Juliana Costa">Dra. Juliana Costa</option>
                    </select>
                    <div class="error-message" id="medicoRecebeError">Selecione um médico</div>
                </div>
                
                <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 20px; margin-bottom: 25px;">
                    <label style="display: flex; align-items: center; gap: 12px;">
                        <input type="checkbox" style="width: 20px; height: 20px; accent-color: var(--darker);" id="checkVisitados">
                        <span>Todos os pacientes foram visitados</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 12px;">
                        <input type="checkbox" style="width: 20px; height: 20px; accent-color: var(--darker);" id="checkRepassado">
                        <span>Plantão repassado para o médico seguinte</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 12px;">
                        <input type="checkbox" style="width: 20px; height: 20px; accent-color: var(--darker);" id="checkPrescricoes">
                        <span>Todas as prescrições foram atualizadas</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 12px;">
                        <input type="checkbox" style="width: 20px; height: 20px; accent-color: var(--darker);" id="checkDocumentacao">
                        <span>Documentação completa de todos os atendimentos</span>
                    </label>
                </div>
                
                <div class="form-group">
                    <label>Assinatura Digital</label>
                    <input type="text" class="form-control" id="assinatura" 
                           placeholder="Digite seu nome completo para assinar" readonly>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn" id="btnCancelPass" style="background: rgba(0,0,0,0.08); color: var(--dark);">
                    Cancelar
                </button>
                <button class="btn btn-success" id="btnConfirmPass">
                    Confirmar Passagem
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Novo Setor -->
    <div class="modal" id="newSetorModal">
        <div class="modal-content card">
            <div class="modal-header">
                <h2 class="modal-title">Adicionar Novo Setor</h2>
            </div>
            
            <div class="progress-container">
                <div class="progress-header">
                    <span>Setores: <span id="currentSetorCount">0</span>/<span id="maxSetor">5</span></span>
                    <span id="maxSetorMessage" style="color: var(--danger); display: none;">Máximo atingido</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            
            <div class="form-group">
                <label>Nome do Setor</label>
                <input type="text" class="form-control" id="setorName" placeholder="Ex: UTI Adulto, Emergência">
                <div class="error-message" id="setorNameError">Informe o nome do setor</div>
            </div>
            
            <!-- Turnos personalizados -->
            <div id="turnosContainer">
                <!-- Turnos serão adicionados dinamicamente aqui -->
            </div>
            <div class="error-message" id="turnosError">Adicione pelo menos um turno</div>
            
            <div class="modal-footer">
                <button class="btn" id="btnCancelSetor" style="background: rgba(0,0,0,0.08); color: var(--dark);">
                    Cancelar
                </button>
                <button class="btn btn-success" id="btnSaveSetor">
                    Salvar Setor
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Novo Paciente -->
    <div class="modal" id="newPacienteModal">
        <div class="modal-content card">
            <div class="modal-header">
                <h2 class="modal-title">Adicionar Novo Paciente</h2>
            </div>
            
            <div class="form-group">
                <label>Nome Completo</label>
                <input type="text" class="form-control" id="pacienteName" placeholder="Nome do paciente">
                <div class="error-message" id="pacienteNameError">Informe o nome do paciente</div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                <div class="form-group">
                    <label>Idade</label>
                    <input type="number" class="form-control" id="pacienteIdade" placeholder="Idade" min="0" max="120">
                    <div class="error-message" id="pacienteIdadeError">Informe uma idade válida</div>
                </div>
                
                <div class="form-group">
                    <label>Sexo Biológico</label>
                    <select class="form-control" id="pacienteSexo">
                        <option value="">Selecione</option>
                        <option value="M">Masculino</option>
                        <option value="F">Feminino</option>
                    </select>
                    <div class="error-message" id="pacienteSexoError">Selecione o sexo biológico</div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                <div class="form-group">
                    <label>Leito</label>
                    <input type="text" class="form-control" id="pacienteLeito" placeholder="Número do leito">
                    <div class="error-message" id="pacienteLeitoError">Informe o número do leito</div>
                </div>
                
                <div class="form-group">
                    <label>Nº Atendimento</label>
                    <input type="text" class="form-control" id="pacienteAtendimento" placeholder="Número do atendimento">
                    <div class="error-message" id="pacienteAtendimentoError">Informe o número do atendimento</div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn" id="btnCancelPaciente" style="background: rgba(0,0,0,0.08); color: var(--dark);">
                    Cancelar
                </button>
                <button class="btn btn-success" id="btnSavePaciente">
                    Adicionar Paciente
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Alta -->
    <div class="modal" id="altaModal">
        <div class="modal-content card">
            <div class="modal-header">
                <h2 class="modal-title">Registrar Alta</h2>
            </div>
            
            <div class="form-group">
                <label>Tipo de Alta</label>
                <select class="form-control" id="tipoAlta">
                    <option value="">Selecione o tipo de alta</option>
                    <option value="melhora">Alta por melhora clínica</option>
                    <option value="pedido">Alta a pedido</option>
                    <option value="domiciliar">Alta com encaminhamento para cuidados domiciliares</option>
                    <option value="retorno">Alta com retorno programado</option>
                    <option value="obito">Alta por óbito</option>
                    <option value="transferencia">Alta por transferência</option>
                    <option value="administrativa">Alta administrativa</option>
                    <option value="contra_indicacao">Alta contra indicação médica</option>
                </select>
                <div class="error-message" id="tipoAltaError">Selecione o tipo de alta</div>
            </div>
            
            <div class="form-group">
                <label>Data e Hora</label>
                <input type="datetime-local" class="form-control" id="dataAlta">
                <div class="error-message" id="dataAltaError">Informe a data e hora da alta</div>
            </div>
            
            <div class="form-group">
                <label>Observações</label>
                <textarea class="form-control" id="obsAlta" rows="3" placeholder="Detalhes da alta"></textarea>
            </div>
            
            <div class="modal-footer">
                <button class="btn" id="btnCancelAlta" style="background: rgba(0,0,0,0.08); color: var(--dark);">
                    Cancelar
                </button>
                <button class="btn btn-success" id="btnConfirmAlta">
                    Confirmar Alta
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Pendência -->
    <div class="modal" id="pendenciaModal">
        <div class="modal-content card">
            <div class="modal-header">
                <h2 class="modal-title">Criar Pendência</h2>
            </div>
            <div class="form-group">
                <label>Título</label>
                <select class="form-control" id="pendenciaTitulo">
                    <option value="">Selecione um título</option>
                    <option value="Exames pendentes">Exames pendentes</option>
                    <option value="Medicação não administrada">Medicação não administrada</option>
                    <option value="Alta pendente">Alta pendente</option>
                    <option value="Transferência pendente">Transferência pendente</option>
                    <option value="Outra">Outra</option>
                </select>
                <div class="error-message" id="pendenciaTituloError"></div>
            </div>
            <div class="form-group" id="outraPendenciaGroup" style="display: none;">
                <label>Especificar</label>
                <input type="text" class="form-control" id="outraPendencia" placeholder="Descreva a pendência">
            </div>
            <div class="form-group">
                <label>Descrição</label>
                <textarea class="form-control" id="pendenciaDesc" rows="3" placeholder="Descreva a pendência"></textarea>
                <div class="error-message" id="pendenciaDescError"></div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="btnCancelPendencia" style="background: rgba(0,0,0,0.08); color: var(--dark);">
                    Cancelar
                </button>
                <button class="btn btn-success" id="btnSavePendencia">
                    Salvar Pendência
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Seleção de Paciente (Mobile) -->
    <div class="modal" id="selectionModal">
        <div class="modal-content card selection-modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Selecione um Paciente</h2>
            </div>
            <div class="scrollable-content" id="selectionModalContent"></div>
        </div>
    </div>

    <!-- Modal de Confirmação de Exclusão (MODERNIZADO) -->
    <div class="modal" id="confirmDeleteModal">
        <div class="modal-content delete-modal-content">
            <div class="delete-modal-header">
                <h2 class="delete-modal-title">Confirmar Exclusão</h2>
            </div>
            <div class="delete-modal-body">
                <p>Tem certeza que deseja excluir o paciente <strong id="patientNameToDelete"></strong>?</p>
                <div class="delete-warning">
                    <p><strong>Esta ação não pode ser desfeita</strong> e todos os dados serão perdidos.</p>
                </div>
                <p style="margin-top: 15px; color: var(--dark);">
                    <strong>Recomendação:</strong> Se o paciente recebeu alta, utilize a opção "Registrar Alta" em vez de excluir.
                </p>
                <div class="form-group" style="margin-top: 20px;">
                    <label>Para confirmar, digite "excluir" no campo abaixo.</label>
                    <input type="text" class="form-control" id="confirmDeleteInput" placeholder="Digite excluir">
                    <div class="error-message" id="confirmDeleteError" style="display: none;">Digite "excluir" para confirmar</div>
                </div>
            </div>
            <div class="delete-modal-footer">
                <button class="btn btn-secondary" id="btnCancelDelete">
                    Cancelar
                </button>
                <button class="btn" id="btnIsAlta" style="background: white; color: var(--dark); border: 1px solid var(--dark);">
                    É uma Alta
                </button>
                <button class="btn btn-delete-disabled" id="btnConfirmDelete" disabled>
                    Excluir
                </button>
            </div>
        </div>
    </div>

    <script>
        // Dados de exemplo para demonstração
        const dados = {
            setores: [
                {
                    id: 1,
                    nome: "UTI Adulto",
                    turnos: [
                        { id: 1, nome: "Manhã", inicio: "07:00", fim: "12:00", cor: "#2ecc71" },
                        { id: 2, nome: "Tarde", inicio: "13:00", fim: "18:00", cor: "#3498db" },
                        { id: 3, nome: "Noite", inicio: "19:00", fim: "23:00", cor: "#9b59b6" }
                    ],
                    pacientes: [
                        {
                            id: 101,
                            nome: "Maria Oliveira",
                            idade: 68,
                            sexo: "F",
                            leito: "12A",
                            atendimento: "2023001",
                            anotacoes: [
                                {
                                    id: 1001,
                                    texto: "Paciente relata dor torácica intensa e falta de ar.",
                                    timestamp: "2023-06-25T10:15:00",
                                    medico: "Dr. Carlos Silva",
                                    tipo: "texto"
                                },
                                {
                                    id: 1002,
                                    texto: "PA: 150/90 mmHg | FC: 110 bpm | FR: 24 rpm | Temp: 37.2°C",
                                    timestamp: "2023-06-25T10:20:00",
                                    medico: "Dr. Carlos Silva",
                                    tipo: "texto"
                                }
                            ],
                            alta: null,
                            pendencias: []
                        },
                        {
                            id: 102,
                            nome: "Carlos Santos",
                            idade: 55,
                            sexo: "M",
                            leito: "15B",
                            atendimento: "2023002",
                            anotacoes: [
                                {
                                    id: 1003,
                                    texto: "Paciente refere tosse produtiva e febre há 3 dias.",
                                    timestamp: "2023-06-25T10:30:00",
                                    medico: "Dr. Carlos Silva",
                                    tipo: "texto"
                                }
                            ],
                            alta: null,
                            pendencias: [
                                {
                                    id: 2001,
                                    titulo: "Exames pendentes",
                                    descricao: "Realizar tomografia de tórax",
                                    criadoPor: "Dr. Carlos Silva",
                                    criadoEm: "2023-06-25T10:35:00",
                                    resolvidoEm: null
                                }
                            ]
                        }
                    ]
                },
                {
                    id: 2,
                    nome: "Emergência",
                    turnos: [
                        { id: 4, nome: "Manhã", inicio: "07:00", fim: "12:00", cor: "#2ecc71" },
                        { id: 5, nome: "Tarde", inicio: "13:00", fim: "18:00", cor: "#3498db" },
                        { id: 6, nome: "Noite", inicio: "19:00", fim: "23:00", cor: "#9b59b6" }
                    ],
                    pacientes: [
                        {
                            id: 201,
                            nome: "João Pereira",
                            idade: 42,
                            sexo: "M",
                            leito: "5",
                            atendimento: "2023003",
                            anotacoes: [],
                            alta: null,
                            pendencias: []
                        }
                    ]
                }
            ],
            plantoes: [
                {
                    id: 1001,
                    setorId: 1,
                    turnoId: 1,
                    medicoResponsavel: "Dr. Carlos Silva",
                    inicio: "2023-06-25T07:00:00",
                    fim: "2023-06-25T12:00:00",
                    status: "finalizado",
                    pacientes: [101, 102],
                    pendencias: [],
                    eventos: [],
                    relatorioTransicao: "Plantão repassado sem pendências críticas"
                },
                {
                    id: 1002,
                    setorId: 2,
                    turnoId: 5,
                    medicoResponsavel: "Dra. Ana Santos",
                    inicio: "2023-06-25T13:00:00",
                    fim: "2023-06-25T18:00:00",
                    status: "finalizado",
                    pacientes: [201],
                    pendencias: [],
                    eventos: [],
                    relatorioTransicao: "Paciente com alta pendente"
                },
                {
                    id: 1003,
                    setorId: 1,
                    turnoId: 2,
                    medicoResponsavel: "Dr. Carlos Silva",
                    inicio: "2023-06-25T13:00:00",
                    fim: "2023-06-25T18:00:00",
                    status: "em_andamento",
                    pacientes: [101],
                    pendencias: [2001],
                    eventos: [
                        {
                            tipo: "alerta",
                            mensagem: "Faltam 30 minutos para o fim do plantão",
                            timestamp: "2023-06-25T17:30:00"
                        }
                    ],
                    relatorioTransicao: ""
                }
            ],
            historico: []
        };

        // Elementos DOM
        const DOM = {
            sidebar: document.getElementById('sidebar'),
            mobileMenuBtn: document.getElementById('mobileMenuBtn'),
            setoresList: document.getElementById('setoresList'),
            btnNewSetor: document.getElementById('btnNewSetor'),
            patientTitle: document.getElementById('patientTitle'),
            patientDetails: document.getElementById('patientDetails'),
            patientToggle: document.getElementById('patientToggle'),
            searchInput: document.getElementById('searchInput'),
            autocompleteContainer: document.getElementById('autocompleteContainer'),
            soapTabs: document.querySelectorAll('.soap-tab'),
            editorContents: document.querySelectorAll('.editor-content'),
            btnPassPlantaoSidebar: document.getElementById('btnPassPlantaoSidebar'),
            btnPassPlantaoHeader: document.getElementById('btnPassPlantaoHeader'),
            passPlantaoModal: document.getElementById('passPlantaoModal'),
            btnCancelPass: document.getElementById('btnCancelPass'),
            btnConfirmPass: document.getElementById('btnConfirmPass'),
            medicoRecebe: document.getElementById('medicoRecebe'),
            medicoRecebeError: document.getElementById('medicoRecebeError'),
            assinatura: document.getElementById('assinatura'),
            toast: document.getElementById('toast'),
            toastMessage: document.getElementById('toast-message'),
            newSetorModal: document.getElementById('newSetorModal'),
            setorName: document.getElementById('setorName'),
            setorNameError: document.getElementById('setorNameError'),
            btnCancelSetor: document.getElementById('btnCancelSetor'),
            btnSaveSetor: document.getElementById('btnSaveSetor'),
            newPacienteModal: document.getElementById('newPacienteModal'),
            pacienteName: document.getElementById('pacienteName'),
            pacienteNameError: document.getElementById('pacienteNameError'),
            pacienteIdade: document.getElementById('pacienteIdade'),
            pacienteIdadeError: document.getElementById('pacienteIdadeError'),
            pacienteSexo: document.getElementById('pacienteSexo'),
            pacienteSexoError: document.getElementById('pacienteSexoError'),
            pacienteLeito: document.getElementById('pacienteLeito'),
            pacienteLeitoError: document.getElementById('pacienteLeitoError'),
            pacienteAtendimento: document.getElementById('pacienteAtendimento'),
            pacienteAtendimentoError: document.getElementById('pacienteAtendimentoError'),
            btnCancelPaciente: document.getElementById('btnCancelPaciente'),
            btnSavePaciente: document.getElementById('btnSavePaciente'),
            altaModal: document.getElementById('altaModal'),
            tipoAlta: document.getElementById('tipoAlta'),
            tipoAltaError: document.getElementById('tipoAltaError'),
            dataAlta: document.getElementById('dataAlta'),
            dataAltaError: document.getElementById('dataAltaError'),
            obsAlta: document.getElementById('obsAlta'),
            btnCancelAlta: document.getElementById('btnCancelAlta'),
            btnConfirmAlta: document.getElementById('btnConfirmAlta'),
            chatHistory: document.getElementById('chatHistory'),
            messageInput: document.getElementById('messageInput'),
            btnSendMessage: document.getElementById('btnSendMessage'),
            currentSetorCount: document.getElementById('currentSetorCount'),
            progressFill: document.getElementById('progressFill'),
            maxSetorMessage: document.getElementById('maxSetorMessage'),
            maxSetor: document.getElementById('maxSetor'),
            patientHeader: document.getElementById('patientHeader'),
            editorContainer: document.getElementById('editorContainer'),
            turnosContainer: document.getElementById('turnosContainer'),
            turnosError: document.getElementById('turnosError'),
            selectionModal: document.getElementById('selectionModal'),
            selectionModalContent: document.getElementById('selectionModalContent'),
            btnContextMenu: document.getElementById('btnContextMenu'),
            contextMenu: document.getElementById('contextMenu'),
            pendenciaModal: document.getElementById('pendenciaModal'),
            pendenciaTitulo: document.getElementById('pendenciaTitulo'),
            pendenciaTituloError: document.getElementById('pendenciaTituloError'),
            outraPendencia: document.getElementById('outraPendencia'),
            outraPendenciaGroup: document.getElementById('outraPendenciaGroup'),
            pendenciaDesc: document.getElementById('pendenciaDesc'),
            pendenciaDescError: document.getElementById('pendenciaDescError'),
            btnCancelPendencia: document.getElementById('btnCancelPendencia'),
            btnSavePendencia: document.getElementById('btnSavePendencia'),
            pendenciasContainer: document.getElementById('pendenciasContainer'),
            selectionModalContent: document.getElementById('selectionModalContent'),
            patientActions: document.getElementById('patientActions'),
            confirmDeleteModal: document.getElementById('confirmDeleteModal'),
            patientNameToDelete: document.getElementById('patientNameToDelete'),
            btnCancelDelete: document.getElementById('btnCancelDelete'),
            btnIsAlta: document.getElementById('btnIsAlta'),
            btnConfirmDelete: document.getElementById('btnConfirmDelete'),
            confirmDeleteInput: document.getElementById('confirmDeleteInput'),
            confirmDeleteError: document.getElementById('confirmDeleteError'),
            filtroDataInicio: document.getElementById('filtroDataInicio'),
            filtroDataFim: document.getElementById('filtroDataFim'),
            filtroSetor: document.getElementById('filtroSetor'),
            filtroResponsavel: document.getElementById('filtroResponsavel'),
            filtroStatus: document.getElementById('filtroStatus'),
            btnAplicarFiltros: document.getElementById('btnAplicarFiltros'),
            historicoGrid: document.getElementById('historicoGrid')
        };

        // Estado da aplicação
        let state = {
            currentSetor: null,
            currentPaciente: null,
            currentDoctor: "Dr. Carlos Silva",
            lastEdit: new Date().toISOString(),
            turnoCount: 0,
            keyboardOpen: false,
            resizeTimer: null,
            activeTab: "plantao"
        };

        // Funções auxiliares
        function formatTime(timeStr) {
            return timeStr.slice(0, 5); // Formata para HH:MM
        }

        function getCurrentTimeInMinutes() {
            const now = new Date();
            return now.getHours() * 60 + now.getMinutes();
        }

        function timeToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        function minutesToTime(minutes) {
            const hrs = Math.floor(minutes / 60);
            const mins = minutes % 60;
            return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
        }

        // Função para calcular o turno ativo
        function calcularTurnoAtual(turnos) {
            const agoraMin = getCurrentTimeInMinutes();
            let turnoAtivo = null;
            let proximoTurno = null;
            let turnoEncerrado = null;
            let minutosParaFim = Infinity;

            for (const turno of turnos) {
                const inicioMin = timeToMinutes(turno.inicio);
                let fimMin = timeToMinutes(turno.fim);

                // Ajuste para turnos que passam da meia-noite
                if (fimMin < inicioMin) {
                    fimMin += 24 * 60; // Adiciona um dia em minutos
                }

                // Verifica se o turno está ativo
                if (agoraMin >= inicioMin && agoraMin < fimMin) {
                    turnoAtivo = turno;
                    minutosParaFim = fimMin - agoraMin;
                    break;
                }

                // Verifica se é o próximo turno
                if (agoraMin < inicioMin && (proximoTurno === null || inicioMin < timeToMinutes(proximoTurno.inicio))) {
                    proximoTurno = turno;
                }

                // Verifica turnos encerrados
                if (agoraMin >= fimMin && (turnoEncerrado === null || fimMin > timeToMinutes(turnoEncerrado.fim))) {
                    turnoEncerrado = turno;
                }
            }

            // Retorna o turno ativo se encontrado
            if (turnoAtivo) {
                return {
                    turno: turnoAtivo,
                    status: 'ativo',
                    minutosParaFim: minutosParaFim
                };
            }

            // Retorna o próximo turno se encontrado
            if (proximoTurno) {
                return {
                    turno: proximoTurno,
                    status: 'proximo',
                    minutosParaInicio: timeToMinutes(proximoTurno.inicio) - agoraMin
                };
            }

            // Retorna o último turno encerrado
            if (turnoEncerrado) {
                return {
                    turno: turnoEncerrado,
                    status: 'encerrado'
                };
            }

            // Caso não encontre nenhum turno
            return {
                turno: null,
                status: 'sem_turno'
            };
        }

        // Função para renderizar o badge do turno
        function renderTurnoBadge(turnoInfo) {
            if (!turnoInfo.turno) return '';

            const turno = turnoInfo.turno;
            const status = turnoInfo.status;
            
            let badgeClass = '';
            let badgeText = '';
            let icon = '';

            switch (status) {
                case 'ativo':
                    badgeClass = 'turno-ativo';
                    badgeText = `${turno.nome} (${formatTime(turno.inicio)}-${formatTime(turno.fim)})`;
                    
                    // Adiciona ícone de relógio se faltar menos de 30 minutos
                    if (turnoInfo.minutosParaFim <= 30) {
                        icon = '<i class="fas fa-clock turno-icon"></i>';
                    }
                    break;
                    
                case 'proximo':
                    badgeClass = 'turno-proximo';
                    badgeText = `${turno.nome} (${formatTime(turno.inicio)}-${formatTime(turno.fim)})`;
                    break;
                    
                case 'encerrado':
                    badgeClass = 'turno-encerrado';
                    badgeText = `${turno.nome} (Encerrado)`;
                    break;
                    
                default:
                    badgeClass = 'turno-encerrado';
                    badgeText = 'Sem turno ativo';
            }

            return `<span class="turno-badge ${badgeClass}">${badgeText}${icon}</span>`;
        }

        // Função para verificar alertas de turno
        function verificarAlertasTurno(turnoInfo) {
            if (!turnoInfo.turno) return;

            const status = turnoInfo.status;
            
            if (status === 'ativo') {
                const minutosParaFim = turnoInfo.minutosParaFim;
                
                if (minutosParaFim <= 30 && minutosParaFim > 0) {
                    showToast(`Faltam ${minutosParaFim} minutos para o fim do turno ${turnoInfo.turno.nome}`, 'warning');
                } else if (minutosParaFim <= 0) {
                    showToast(`O turno ${turnoInfo.turno.nome} terminou!`, 'error');
                }
            }
        }

        // Renderizar setores e pacientes
        function renderSetores(container = DOM.setoresList, isModal = false) {
            container.innerHTML = '';
            
            // Se não houver setores, mostrar mensagem
            if (dados.setores.length === 0) {
                container.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: var(--gray);">
                        <p>Nenhum setor criado</p>
                        ${isModal ? '' : `<button class="btn" style="margin-top: 15px;" id="btnFirstSetor">Criar Primeiro Setor</button>`}
                    </div>
                `;
                
                if (!isModal) {
                    document.getElementById('btnFirstSetor').addEventListener('click', openNewSetorModal);
                }
                return;
            }
            
            dados.setores.forEach(setor => {
                const isExpanded = state.currentSetor === setor.id;
                const turnoInfo = calcularTurnoAtual(setor.turnos);
                const turnoBadge = renderTurnoBadge(turnoInfo);
                
                // Verificar alertas para este setor
                verificarAlertasTurno(turnoInfo);
                
                const setorEl = document.createElement('div');
                setorEl.className = `setor-item ${isExpanded ? 'expanded' : ''} ${state.currentSetor === setor.id ? 'active' : ''}`;
                setorEl.innerHTML = `
                    <div class="setor-name">
                        <div>
                            <span>${setor.nome}</span>
                            ${turnoBadge}
                        </div>
                        <span>${setor.pacientes.length}</span>
                    </div>
                    <div class="pacientes-container">
                        ${setor.pacientes.map(paciente => `
                            <div class="paciente-item ${state.currentPaciente === paciente.id ? 'active' : ''}" data-id="${paciente.id}">
                                <div class="paciente-info">
                                    <div class="paciente-header">
                                        <div class="paciente-name">${paciente.nome}</div>
                                        <div class="paciente-status">
                                            ${paciente.alta ? `<span class="status-badge alta">Alta</span>` : ''}
                                            ${paciente.pendencias && paciente.pendencias.some(p => !p.resolvidoEm) ? `<span class="badge pendencia-badge">Pendência</span>` : ''}
                                        </div>
                                    </div>
                                    <div class="paciente-details">
                                        <span>${paciente.idade} anos</span>
                                        <strong>${paciente.leito}</strong>
                                        <strong>${paciente.atendimento}</strong>
                                        ${paciente.alta ? `<span class="alta-item">${formatAltaType(paciente.alta.tipo)}</span>` : ''}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                        ${isModal ? '' : `<button class="btn" style="margin-top: 10px; width: 100%;" data-setor="${setor.id}">Adicionar Paciente</button>`}
                    </div>
                `;
                
                setorEl.addEventListener('click', (e) => {
                    if (!e.target.closest('.paciente-item') && !e.target.closest('button')) {
                        if (state.currentSetor === setor.id) {
                            state.currentSetor = null;
                        } else {
                            state.currentSetor = setor.id;
                        }
                        renderSetores(container, isModal);
                    }
                });
                
                container.appendChild(setorEl);
                
                // Eventos para pacientes
                setorEl.querySelectorAll('.paciente-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const pacienteId = parseInt(item.getAttribute('data-id'));
                        selectPaciente(pacienteId);
                        if (isModal) {
                            DOM.selectionModal.classList.remove('active');
                        }
                    });
                });
                
                // Evento para botão de adicionar paciente
                if (!isModal) {
                    setorEl.querySelector('button').addEventListener('click', (e) => {
                        e.stopPropagation();
                        openNewPacienteModal(setor.id);
                    });
                }
            });
        }

        // Formatar tipo de alta
        function formatAltaType(tipo) {
            const tipos = {
                'melhora': 'Alta por melhora',
                'pedido': 'Alta a pedido',
                'domiciliar': 'Alta domiciliar',
                'retorno': 'Alta com retorno',
                'obito': 'Óbito',
                'transferencia': 'Transferência',
                'administrativa': 'Alta administrativa',
                'contra_indicacao': 'Alta contra indicação'
            };
            return tipos[tipo] || tipo;
        }
        
        // Formatar data
        function formatDate(datetime) {
            const date = new Date(datetime);
            return date.toLocaleDateString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }
        
        // Formatar data/hora
        function formatDateTime(datetime) {
            const date = new Date(datetime);
            return date.toLocaleString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Selecionar paciente
        function selectPaciente(pacienteId) {
            let paciente = null;
            let setor = null;
            
            // Encontrar paciente e setor
            for (const s of dados.setores) {
                paciente = s.pacientes.find(p => p.id === pacienteId);
                if (paciente) {
                    setor = s;
                    break;
                }
            }
            
            if (!paciente) return;
            
            state.currentSetor = setor.id;
            state.currentPaciente = paciente.id;
            
            // Marcar como paciente selecionado (para mostrar ícones)
            DOM.patientHeader.classList.add('patient-selected');
            
            // Atualizar header do paciente
            DOM.patientTitle.innerHTML = `
                <span>${paciente.nome}</span>
            `;
            
            let detailsHTML = `
                <div class="detail-item">${paciente.idade} anos, ${paciente.sexo === 'M' ? 'Masculino' : 'Feminino'}</div>
                <div class="detail-item">Leito: ${paciente.leito}</div>
                <div class="detail-item">Atendimento: ${paciente.atendimento}</div>
            `;
            
            DOM.patientDetails.innerHTML = detailsHTML;
            
            // Mostrar ações do paciente
            DOM.patientActions.style.display = 'flex';
            
            // Renderizar pendências individuais
            renderPendencias(paciente);
            
            // Mostrar toggle de detalhes
            DOM.patientDetails.style.display = 'none';
            
            // Carregar histórico de mensagens
            renderChatHistory(paciente);
            
            // Atualizar sidebar
            renderSetores();
            
            // Fechar menu no mobile
            if (window.innerWidth <= 992) {
                DOM.sidebar.classList.remove('open');
                DOM.mobileMenuBtn.classList.remove('open');
            }
            
            // CORREÇÃO: Garantir que o editor seja exibido
            DOM.editorContainer.style.display = 'flex';
        }

        // Renderizar histórico de plantões
        function renderHistoricoPlantao() {
            DOM.historicoGrid.innerHTML = '';
            
            if (dados.plantoes.length === 0) {
                DOM.historicoGrid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-content">
                            <div class="empty-icon">
                                <i class="fas fa-history"></i>
                            </div>
                            <h3>Nenhum plantão histórico encontrado</h3>
                            <p>Não foram encontrados registros de plantões passados com os filtros aplicados.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            dados.plantoes.forEach(plantao => {
                const setor = dados.setores.find(s => s.id === plantao.setorId);
                const turno = setor.turnos.find(t => t.id === plantao.turnoId);
                
                const plantaoCard = document.createElement('div');
                plantaoCard.className = 'plantao-card';
                
                // Determinar classe de status
                let statusClass = '';
                let statusText = '';
                
                switch (plantao.status) {
                    case 'em_andamento':
                        statusClass = 'status-em-andamento';
                        statusText = 'Em andamento';
                        break;
                    case 'finalizado':
                        statusClass = 'status-finalizado';
                        statusText = 'Finalizado';
                        break;
                    case 'pendente':
                        statusClass = 'status-pendente';
                        statusText = 'Pendente';
                        break;
                }
                
                plantaoCard.innerHTML = `
                    <div class="plantao-header">
                        <h3>${setor ? setor.nome : 'Setor não encontrado'}</h3>
                        <div class="plantao-info">
                            <div class="plantao-info-item">
                                <div class="plantao-info-label">Turno:</div>
                                <div class="plantao-info-value">${turno ? turno.nome : 'N/A'}</div>
                            </div>
                            <div class="plantao-info-item">
                                <div class="plantao-info-label">Responsável:</div>
                                <div class="plantao-info-value">${plantao.medicoResponsavel}</div>
                            </div>
                            <div class="plantao-info-item">
                                <div class="plantao-info-label">Início:</div>
                                <div class="plantao-info-value">${formatDateTime(plantao.inicio)}</div>
                            </div>
                            <div class="plantao-info-item">
                                <div class="plantao-info-label">Fim:</div>
                                <div class="plantao-info-value">${formatDateTime(plantao.fim)}</div>
                            </div>
                            <div class="plantao-info-item">
                                <div class="plantao-info-label">Status:</div>
                                <div class="plantao-info-value"><span class="plantao-status ${statusClass}">${statusText}</span></div>
                            </div>
                        </div>
                    </div>
                    <div class="plantao-body">
                        <div class="plantao-info">
                            <div class="plantao-info-item">
                                <div class="plantao-info-label">Pacientes:</div>
                                <div class="plantao-info-value">${plantao.pacientes.length}</div>
                            </div>
                            <div class="plantao-info-item">
                                <div class="plantao-info-label">Pendências:</div>
                                <div class="plantao-info-value">${plantao.pendencias.length}</div>
                            </div>
                        </div>
                        
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-content">
                                    <div class="timeline-title">Plantão iniciado</div>
                                    <div class="timeline-time">${formatDateTime(plantao.inicio)}</div>
                                </div>
                            </div>
                            
                            ${plantao.eventos.map(evento => `
                                <div class="timeline-item">
                                    <div class="timeline-content">
                                        <div class="timeline-title">${evento.tipo === 'alerta' ? 'Alerta' : 'Evento'}</div>
                                        <div>${evento.mensagem}</div>
                                        <div class="timeline-time">${formatDateTime(evento.timestamp)}</div>
                                    </div>
                                </div>
                            `).join('')}
                            
                            <div class="timeline-item">
                                <div class="timeline-content">
                                    <div class="timeline-title">Plantão finalizado</div>
                                    <div class="timeline-time">${formatDateTime(plantao.fim)}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="plantao-acoes">
                        <button class="btn-toggle" data-id="${plantao.id}">Ver detalhes</button>
                        <button class="btn" onclick="exportPlantao(${plantao.id}, 'pdf')">
                            <i class="fas fa-download"></i> Relatório
                        </button>
                    </div>
                    <div class="plantao-pacientes">
                        <h4>Pacientes Atendidos</h4>
                        ${plantao.pacientes.map(pacienteId => {
                            const paciente = setor.pacientes.find(p => p.id === pacienteId);
                            return paciente ? `
                                <div class="plantao-paciente">
                                    <div>${paciente.nome}</div>
                                    <div>Leito: ${paciente.leito} | Atendimento: ${paciente.atendimento}</div>
                                </div>
                            ` : '';
                        }).join('')}
                    </div>
                `;
                
                // Evento para expandir detalhes
                plantaoCard.querySelector('.btn-toggle').addEventListener('click', function() {
                    plantaoCard.classList.toggle('expanded');
                    this.textContent = plantaoCard.classList.contains('expanded') ? 'Ocultar detalhes' : 'Ver detalhes';
                });
                
                DOM.historicoGrid.appendChild(plantaoCard);
            });
        }

        // Exportar plantão para diferentes formatos
        function exportPlantao(plantaoId, format) {
            const plantao = dados.plantoes.find(p => p.id === plantaoId);
            if (!plantao) return;
            
            showToast(`Exportando plantão #${plantaoId} em formato ${format.toUpperCase()}`, 'success');
            // Lógica de exportação real seria implementada aqui
        }

        // Inicialização
        function init() {
            renderSetores();
            renderHistoricoPlantao();
            setupEventListeners();
            updateTime();
            setInterval(updateTime, 60000); // Atualizar relógio a cada minuto
            setInterval(updateTurnos, 60000); // Verificar turnos a cada minuto
            updateSetorProgress();
            
            // Preencher filtros de setor no histórico
            dados.setores.forEach(setor => {
                const option = document.createElement('option');
                option.value = setor.id;
                option.textContent = setor.nome;
                DOM.filtroSetor.appendChild(option);
            });
            
            // Verificar alertas de turno inicial
            dados.setores.forEach(setor => {
                const turnoInfo = calcularTurnoAtual(setor.turnos);
                verificarAlertasTurno(turnoInfo);
            });
        }

        // Atualizar turnos
        function updateTurnos() {
            renderSetores();
            
            // Verificar alertas de turno
            dados.setores.forEach(setor => {
                const turnoInfo = calcularTurnoAtual(setor.turnos);
                verificarAlertasTurno(turnoInfo);
            });
        }

        // Atualizar hora atual
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-BR', {
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('currentTime').textContent = timeString;
        }

        // Mostrar toast
        function showToast(message, type = 'success') {
            DOM.toast.className = `toast ${type === 'error' ? 'toast-error' : 'toast-success'}`;
            DOM.toastMessage.textContent = message;
            DOM.toast.classList.add('show');
            
            setTimeout(() => {
                DOM.toast.classList.remove('show');
            }, 3000);
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Menu mobile
            DOM.mobileMenuBtn.addEventListener('click', () => {
                const wasOpen = DOM.sidebar.classList.contains('open');
                DOM.sidebar.classList.toggle('open');
                DOM.mobileMenuBtn.classList.toggle('open');

                if (wasOpen) {
                    // Se estava aberto e agora fechou, colapsar todos os setores
                    state.currentSetor = null;
                } else {
                    // Se estava fechado e agora abriu, renderizar os setores (já colapsados)
                    renderSetores();
                }
            });
            
            // Fechar menu lateral ao clicar fora (mobile)
            document.addEventListener('click', function(event) {
                const isClickInsideSidebar = DOM.sidebar.contains(event.target);
                const isClickOnMenuButton = DOM.mobileMenuBtn.contains(event.target);
                
                if (window.innerWidth <= 992 && DOM.sidebar.classList.contains('open') && 
                    !isClickInsideSidebar && !isClickOnMenuButton) {
                    DOM.sidebar.classList.remove('open');
                    DOM.mobileMenuBtn.classList.remove('open');
                }
            });
            
            // Abas
            DOM.soapTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    
                    // Atualizar aba ativa
                    DOM.soapTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Atualizar conteúdo visível
                    document.querySelectorAll('.editor-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tabName).classList.add('active');
                    
                    state.activeTab = tabName;
                    
                    // Se for a aba de histórico, recarregar dados
                    if (tabName === 'historico') {
                        renderHistoricoPlantao();
                    }
                });
            });
            
            // Botões de exportação
            document.querySelectorAll('.btn-export').forEach(btn => {
                btn.addEventListener('click', function() {
                    const format = this.getAttribute('data-format');
                    exportPlantao(0, format); // Exportar todos os plantões
                });
            });
            
            // Aplicar filtros
            DOM.btnAplicarFiltros.addEventListener('click', renderHistoricoPlantao);
            
            // ... outros event listeners permanecem inalterados ...
        }

        // Inicializar aplicação
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>